#https://wiki.gentoo.org/wiki//etc/portage/make.conf
#https://wiki.gentoo.org/wiki/GCC_optimization
#https://wiki.gentoo.org/wiki/Safe_CFLAGS
#https://gcc.gnu.org/onlinedocs/gcc-6.4.0/gcc/x86-Options.html#x86-Options
#ryzen:
#CFLAGS="-O2 -pipe -march=znver1 -mtune=znver1"
#CXXFLAGS="${CFLAGS}"
#Generic cpu https://www.funtoo.org/Generic_64
#CFLAGS="-mtune=generic -O2 -pipe"
### ================================ gentoolto repo settings
#FLTO should be of the form -flto[=n] where n is the number of threads to use during linking.
#It's usually a good idea to set this to the number of hardware threads in your system
FLTO="-flto=16"

#GRAPHITE contains Graphite specific optimizations and other optimizations that are disabled at O3
#but don't influence the compiler's judgement.
#These should be updated with GCC 7.2.1 (-ftree-loop-distribution may be enabled
#by -O3 by default)
GRAPHITE="-fgraphite-identity -ftree-loop-distribution -floop-nest-optimize"

#FLTO and GRAPHITE are variables used in the LTO and Graphite overrides as well.  If you don't want Graphite or LTO,
#just unset these variables--no further action is necessary.  Don't rename these variables as the overrides depend on them.

#These variables are required to be set to their appropriate GCC wrappers.
#NOTE: SEE ISSUE THREAD IN GENTOOLTO GITHUB FOR NEWER WAY OF DOING THIS.  I'm waiting on it being upstreamed.
AR=gcc-ar
NM=gcc-nm
RANLIB=gcc-ranlib

#Your CFLAGS should contain ${FLTO} and, depending on your gcc, -fuse-linker-plugin
#Newer GCCs enable -fuse-linker-plugin by default.
#${GRAPHITE} should be included here as well.  If you do not want Graphite, just unset the GRAPHITE variable and keep CFLAGS the same.
#It will be easier for you to experiment that way.
CFLAGS="-march=znver1 -mtune=znver1 -O3 ${GRAPHITE} ${FLTO} -fuse-linker-plugin -pipe"

#Your CXXFLAGS should be a superset of your CFLAGS.  Most people will never need to add anything extra to their CXXFLAGS.
CXXFLAGS="${CFLAGS}"

#Your LDFLAGS should contain *ALL* of your CFLAGS for LTO to work.  It must receieve all optimization options, march, etc.
#It's usually a good idea to enable -Wl,--hash-style=gnu as well to help find packages which don't respect LDFLAGS
#NEW: package.cflags takes care of this for you--no need to manually add your {C,CXX}FLAGS here.
#Your profile likely contains a -Wl,-O1 in there--that could potentially conflict with LTO settings, so we remove it here.
LDFLAGS="-Wl,--as-needed -Wl,--hash-style=gnu"

### ================================ gentoolto repo settings END

CHOST="x86_64-pc-linux-gnu"
USE="-webstart -java -cdda -dvd -cups -samba -ldap -openldap webp lto pgo wayland evdev libinput d3d9 luajit idn libressl color-management colord caps smp threads pch gmp gbm jit zsh-completion networkmanager drm v4l egl cjk icu vaapi vdpau symlink infinality pulseaudio bindist"
USE="${USE} -webkit -gstreamer -wifi -bluetooth -modemmanager gtkstyle"
# https://bugs.gentoo.org/631788
USE="${USE} -qt4 -qt3support"
# xinerama is needed for app-emulation/wine-* media-libs/libsdl2 x11-libs/gtk+ net-misc/freerdp x11-misc/compton
USE="${USE} -xinerama"
# remove this after migration to radeon/wayland
USE="${USE} xa xv xvmc xscreensaver"
# tslib tuio ibus opencl tuio
INPUT_DEVICES="evdev joystick libinput"
MAKEOPTS="-j16"
#https://wiki.gentoo.org/wiki/CPU_FLAGS_X86
#https://forums.gentoo.org/viewtopic-t-1061546.html
CPU_FLAGS_X86="aes avx avx2 f16c fma3 mmx mmxext popcnt sse sse2 sse3 sse4_1 sse4_2 sse4a ssse3"
VIDEO_CARDS="nouveau"
# https://bugs.gentoo.org/show_bug.cgi?id=630970
INSTALL_MASK="/etc/xdg/autostart/pulseaudio.desktop /usr/lib64/torbrowser/gtk2 /etc/init.d /etc/logrotate.d /etc/conf.d /etc/runlevels /etc/cron* /etc/X11/xinit/xinitrc.d/80-dbus /etc/env.d/99torbrowser /usr/lib/sysctl.d/50-coredump.conf"
UNINSTALL_IGNORE="/etc/portage/env"
PKG_INSTALL_MASK="${INSTALL_MASK}"
L10N="en en-US en-GB ru ja"
LINGUAS="en en_EN en_GB en_US ru ru_RU ja ja_JP"
#https://gitweb.gentoo.org/proj/portage.git/tree/cnf/make.globals#n52
#https://wiki.gentoo.org/wiki/Distcc#With_Portage
FEATURES="network-sandbox ccache clean-logs ipc-sandbox parallel-install xattr cgroup binpkg-multi-instance"
CCACHE_SIZE="20G"
#https://bugs.gentoo.org/show_bug.cgi?id=630558
EGIT_CLONE_TYPE=shallow
#https://bugs.gentoo.org/634250
#BINPKG_COMPRESS="zstd"
#BINPKG_COMPRESS_FLAGS="-16 -T4"

#https://www.reddit.com/r/Gentoo/comments/6x1zhi/tip_to_have_a_more_responsive_desktop_while_you/
#PORTAGE_NICENESS=15
#PORTAGE_IONICE_COMMAND="ionice -c 3 -p \${PID}"

EMERGE_DEFAULT_OPTS="--buildpkg=y --usepkg=y --nospinner --keep-going=y --jobs=2 --load-average=6 --quiet-build=y --quiet-fail=y --tree --with-bdeps=y --complete-graph=y --buildpkg-exclude 'sys-kernel/*-sources games-*/*'"
GENTOO_MIRRORS="https://mirror.dkm.cz/gentoo/ https://mirrors.kernel.org/gentoo/ https://gentoo.osuosl.org/"
DISTDIR="/var/cache/distfiles"
PKGDIR="/var/packages/x86_64-pc-linux-gnu"
